<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../head') %>
  <meta name="description" content="Latest news and updates from OldSchoolGames - classic MS-DOS gaming community" />
  <title><%= title %></title>
  <!-- Open Graph -->
  <meta property="og:title" content="<%= title %>" />
  <meta property="og:description" content="Latest news and updates from OldSchoolGames - classic MS-DOS gaming community" />
  <meta property="og:url" content="<%= req.protocol + '://' + req.get('host') + req.originalUrl %>" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="OldSchoolGames" />
</head>

<body class="layout">
  <%- include('../navbar') %>
  <%- include('../left-sidebar') %>
  <main>
    <div class="container">
      <%- include('../flash') %>
      <section>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h1 class="text-xl" style="margin: 0;">News & Updates</h1>
          <% if (req.session?.user?.role === 'ADMIN') { %>
          <a class="btn btn-outline" href="/news/new">+ Add News</a>
          <% } %>
        </div>
        <% if (news.length === 0) { %>
        <p class="news-empty">
          No news yet. Check back later!
        </p>
        <% } else { %> <% news.forEach((newsItem, index) => { %>
        <article class="news-item <% if (index > 0) { %>news-item-bordered<% } %>">
          <h2 class="news-title"><%= newsItem.title %></h2>
          <div class="news-meta">
            <time datetime="<%= new Date(newsItem.createdAt).toISOString() %>">
              <%= new Date(newsItem.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
            </time>
          </div>
          <div class="news-content"><%- newsItem.content %></div>
        </article>
        <% }); %>

        <!-- Pagination -->
        <% if (totalPages > 1) { %>
        <nav aria-label="News pagination" class="news-pagination">
          <ul class="pagination">
            <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="/news?page=<%= currentPage - 1 %>" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <% } %> <% for (let i = Math.max(1, currentPage - 2); i <=
              Math.min(totalPages, currentPage + 2); i++) { %>
            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
              <a class="page-link" href="/news?page=<%= i %>"><%= i %></a>
            </li>
            <% } %> <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a class="page-link" href="/news?page=<%= currentPage + 1 %>" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            <% } %>
          </ul>
        </nav>
        <% } %>

        <div class="news-showing">
          Showing <%= (currentPage - 1) * 10 + 1 %>-<%=
            Math.min(currentPage * 10, total) %> of <%= total %> news
          items
        </div>
        <% } %>
      </section>
    </div>
  </main>
  <%- include('../right-sidebar') %>
  <%- include('../footer') %>
</body>

</html>
